# Visitor

### Visitorとは
- データ構造を表すクラスとそれに対する操作を行うクラスを分離するパターン
  - 操作を行うクラスがデータ構造を表すクラスを訪問し、順に処理を行う
  - データ構造を表すクラスには操作を記述する代わりに、訪問者を受け入れるためのメソッドを用意する

### クラス図
![クラス図](./%E3%82%AF%E3%83%A9%E3%82%B9%E5%9B%B3.png)

- Visitor
  - 訪問者となる抽象クラス or インターフェース
  - 引数に渡されたデータ構造を操作するためのAPIを定義
  - 操作するデータ構造の型ごとにAPIを定義することもある
- ConcreteVisitor
  - Visitorを継承する子クラス
  - データ構造を操作する具体的な処理を実装
- Element
  - データ構造を表すための抽象クラス or インターフェース
  - Visitorのオブジェクトを受け入れるためのAPIを定義
- ConcreteElement
  - Elementを継承する子クラス
  - Visitorのオブジェクトを受け入れるための具体的な処理を実装

### オブジェクト指向的要素
- ダブルディスパッチを利用
  - 訪問者と受け入れる側がお互いのメソッドを呼び出す
    - 受け入れる側のメソッド：element.accept(visitor)
    - 訪問する側のメソッド：visitor.visit(element)
  - Elementの具体的な型とVisitorの具体的な型によって実行される処理が確定

### メリデメ
- メリット
  - データ構造と操作を分離し、共通な操作を一箇所にまとめることができる
  - 新しい操作(Visitor)を容易に追加できる
- デメリット
  - 新しいデータ構造を追加することは困難

### 使い所
- ツリー構造のような複雑なオブジェクト構造の全ての要素に対して、ある操作を実行する必要がある場合
  - ディレクトリツリー、組織階層、DOMツリー
- 特定のデータ構造に対して、操作を色々変化させたい場合
  - データ構造を固定して操作を変化させる